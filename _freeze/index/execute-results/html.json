{
  "hash": "06983d000c955c6100955ae8cf752ece",
  "result": {
    "markdown": "---\ntitle: \"subcell-correlation\"\nformat: html\nexecute:\n  freeze: true\n---\n\n\n# Comparing Sub-cellular spatial transcriptomics technical variability\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNBINS <- 200\n```\n:::\n\n\n::: panel-tabset\n## CosMX\n\nOf the three replicates (Lung5), two adjacent ones (2 and 3) were lined up manually (using `shinySTRegister`).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlung5 <- cbind(\n  readRDS(\"data/cosmx/aligned/Lung5_Rep2_spe.rds\"),\n  load_cosmx_as_spatial_experiment(\n    \"data/cosmx/Lung5_Rep3_exprMat_file.csv\",\n    \"data/cosmx/Lung5_Rep3_metadata_file.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n'sample_id's are duplicated across 'SpatialExperiment' objects to cbind; appending sample indices.\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbinned_lung5 <- convert_spe_to_image(lung5)\n```\n:::\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\nplot_counts(binned_lung5)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n### Spot-based correlation across transcripts\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum_counts_per_bin(lung5, NBINS) |>\n  plot_counts_correlations()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n## Merscope\n\n\n::: {.cell}\n\n```{.r .cell-code}\novarian2 <- cbind(\n  readRDS(\"data/merscope/aligned/HumanOvarianCancerPatient2Slice1_spe.rds\"),\n  load_merscope_as_spatial_experiment(\n    \"data/merscope/HumanOvarianCancerPatient2Slice3_cell_by_gene.csv\",\n    \"data/merscope/HumanOvarianCancerPatient2Slice3_cell_metadata.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n'sample_id's are duplicated across 'SpatialExperiment' objects to cbind; appending sample indices.\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbinned_ovarian2 <- convert_spe_to_image(ovarian2)\n```\n:::\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\nplot_counts(binned_ovarian2)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n### Spot-based correlation across transcripts\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum_counts_per_bin(ovarian2, NBINS) |>\n  plot_counts_correlations()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n## Xenium\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbreast <- cbind(\n  readRDS(\"data/xenium/aligned/Xenium_FFPE_Human_Breast_Cancer_Rep1_spe.rds\"),\n  load_xenium_as_spatial_experiment(\n    \"data/xenium/Xenium_FFPE_Human_Breast_Cancer_Rep2_cell_feature_matrix.csv\",\n    \"data/xenium/Xenium_FFPE_Human_Breast_Cancer_Rep2_cells.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n'sample_id's are duplicated across 'SpatialExperiment' objects to cbind; appending sample indices.\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbinned_breast <- convert_spe_to_image(breast)\n```\n:::\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\nplot_counts(binned_breast)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n### Spot-based correlation across transcripts\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum_counts_per_bin(breast, NBINS) |>\n  plot_counts_correlations()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n:::\n\n### RNiftyReg vs. manual alignment\n\nThese alignments were performed by hand, automated alignment (using `RNiftyReg`) failed in all cases except for CosMX. Even in this case, the results were slightly worse than with manual alignment.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/nifty_v_manual-1.png){width=672}\n:::\n:::\n\n\n# Comparison across technologies\n\n::: panel-tabset\n## 300 bins\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNBINS <- 300\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(correlation_data, aes(x = correlation, color = type)) +\n  geom_density()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n## 200 bins\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNBINS <- 200\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(correlation_data, aes(x = correlation, color = type)) +\n  geom_density()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\n## 100 bins\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNBINS <- 100\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(correlation_data, aes(x = correlation, color = type)) +\n  geom_density()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n:::\n\n## Note\n\nThese results show a clear difference in the technical variability of these technologies *as applied to these different tissues*. Differences in tissue heterogeneity, genes measured and/or sample surface are likely to influence this comparison.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}